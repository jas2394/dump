<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>JavaScript: The Complete Reference&#153;, Third Edition</title>
<link href="0071741216.css" rel="stylesheet" type="text/css"/>
<link href="page-template.xpgt" rel="stylesheet" type="application/vnd.adobe-page-template+xml"/>
<meta content="urn:uuid:4d1be0af-c0d3-47b8-9bd4-3edcb4dee196" name="Adept.expected.resource"/>
</head>
<body>
<h3 class="h3b" id="ch14"><a id="page_611"/><strong>CHAPTER 14<br/>User Interface Elements</strong></h3>
<p class="noindent">In the previous chapters, we have explored windows, dialogs, and a variety of form fields. There are a few more Web interface items that can be created or improved with JavaScript, so we take some time in this chapter to discuss those that have been missed. We will begin the discussion by addressing how we might go about adding JavaScript into a Web page or application. During this discussion, we will see two schools of thought—one that works upward from markup and one that works downward from script. After understanding these approaches, we will survey a number of interface elements we might employ. However, we should note that because the range of interface elements is quite vast, we will not present all possible user interface constructs but illustrate approaches and emphasize those that have standard tags and APIs defined under HTML5.</p>
<h4 class="h4"><a id="ch14lev1sec1"/><strong>Adding JavaScript</strong></h4>
<p class="noindent">How JavaScript is employed interface-wise in a Web site or application will depend greatly on the type of application or site we are dealing with and the value that such techniques will provide. We might aim to use only small amounts of JavaScript that improve experience, or we might aim to build the entire site or application in JavaScript and move far away from traditional pages and architecture.</p>
<p class="indent">If at one extreme, we completely re-architect our application to rely on JavaScript, it will utterly fail if JavaScript is off or the browser does not support the particular API we rely on. Conversely, we might be quite conservative and design our site or application to use very little JavaScript—but then again, what’s the point of reading this book if you are going to take that route?</p>
<p class="indent">Pragmatic Web developers usually don’t opt for all-or-nothing approaches to technology use. They likely reason, even when being conservative, that they should provide a richer interface or more functionality with JavaScript to those who can handle it, but simply not require it for those who can’t. Users will have a more pleasing or powerful experience with <a id="page_612"/>JavaScript-enabled technologies available, but they will not be locked out from the site or application without it either. This idea, starting from the most basic technologies and layering more complexity on top of that based on user capabilities, is called <em>progressive enhancement</em>.</p>
<p class="indent">If we approach design with the JavaScript-required or at least the highly recommended point of view, we believe that the site or application functionality and experience really are best with the latest technology. However, acknowledging the simple fact that ideal conditions do not always prevail, we might opt to reduce functionality in some situations to some acceptable level or at the very least provide useful information if the user’s browser does not support the functionality. Starting from complexity and reducing or failing well is typically termed <em>graceful degradation</em>.</p>
<p class="indent">To illustrate the range of choices and what end of the spectrum we start from, first consider the range of presentations we might enjoy online:</p>
<p class="imagea"><img alt="image" src="f0612-01.jpg"/></p>
<p class="noindent"><a id="page_613"/>Such a range would also hold for the technology used to implement such a look:</p>
<p class="imagea"><img alt="image" src="f0613-01.jpg"/></p>
<hr/>
<p class="note"><strong>NOTE</strong> If you have some aversion to seeing Flash in the diagram, simply understand that it is meant to indicate the need for some binary technology, often for multimedia. Insert whatever term makes you comfortable, but it was the shortest way to represent that.</p>
<p class="noindent">What we are doing here is illustrating the rise in complexity, as the combinations might vary outside our progression, and other complications such as frames might be introduced. The point here is simply that we increase complexity as we layer on more technologies.</p>
<p class="indent"><a id="page_614"/>The range varies along numerous parameters. For example, if we consider the network, we might range from disconnected from the network, to the network connected at low speeds and high latency, to a very fast connection with low latency. Of course, once connected, we might imagine that the consistency of the network conditions may vary:</p>
<p class="imagea"><img alt="image" src="f0614-01.jpg"/></p>
<p class="noindent">In <a class="nounder" href="ch15.html#ch15">Chapter 15</a>, when we discuss Ajax, we’ll see that it is quite important to understand how to communicate using JavaScript and respect all the various challenges we may encounter during communication.</p>
<p class="indent">The actual content itself in a site or application ranges from static content presented to all users, to customized content on a per-user or per-group basis, and even to interactive or participatory content:</p>
<p class="imagea"><a id="page_615"/><img alt="image" src="f0615-01.jpg"/></p>
<p class="indent">Continuing along these lines is our Web application interface, a traditional read—that is, a read-and-click or form-fill affair—or a direct manipulation interface where objects are selected, dragged, and combined.</p>
<p class="imagea"><img alt="image" src="f0615-02.jpg"/></p>
<p class="indent"><a id="page_616"/>Now that we have seen some of the vast range of decisions, we reiterate that progressive enhancement is the idea of adding features and technologies to a site that corresponds to increased capabilities of visiting end users. Similarly, the idea of graceful degradation is that you start with a technically sophisticated and feature-rich site and degrade to the capabilities and features the user is capable of handling. Both ideas are quite similar to adapting to the conditions of the user. In the case of progressive enhancement, we build up from basic features to more advanced, while in the case of graceful degradation, we tend to start with a high fidelity execution and reduce down.</p>
<p class="indent">The choice between starting from basic features and adding on or starting with the desired high-end experience and seeing what can fall away is somewhat of a philosophical one and tends to be based on your desire to be inclusive or exclusive. However, regardless of the selection, there will be different experiences for end users, and the reality is that it is not possible to service everyone with the same experience in an acceptable manner. JavaScript developers won’t easily satisfy those with a decade-old browser and computer technology, but neither should they aim to please only those who upgraded to the latest releases just yesterday.</p>
<p class="indent">The choice between progressive enhancement and graceful degradation will depend much on the type of application or site being built, as well as on the cost/benefit provided by the amount of flexibility that is desired. Yet more often than not, in the evolution of an existing Web site or application, progressive enhancement will likely be the philosophy of choice. It might be thought, then, that for a brand-new application built in the HTML5 era, graceful degradation is the preferred philosophy. However, that may not be the case, as there will always be known limitations unless you degrade to the oldest forms of technologies. This begs the question, “Why not approach things from the other direction for the sake of simplicity?” The trade-offs and limitations alluded to will all become clear as we implement examples, so let’s get started by exploring a simple example of progressive enhancement.</p>
<h5 class="h5"><a id="ch14lev2sec1"/><strong>Exploring Progressive Enhancement</strong></h5>
<p class="noindent">The idea of progressive enhancement, as previously mentioned, is to layer technology on top of some other base technology. As an example of progressive enhancement, we will layer JavaScript on some HTML markup to take a static document and make it more interactive.</p>
<p class="indent">Imagine, as an example, that we had a large volume of content we wanted to show a user. Obviously, we might break it up into sections with markup, like so:</p>
<p class="imagea"><img alt="image" src="f0616-01.jpg"/></p>
<p class="imagea"><img alt="image" src="f0616-02.jpg"/></p>
<p class="indent"><a id="page_617"/>Now this won’t look terribly motivating:</p>
<p class="imagea"><img alt="image" src="f0617-01.jpg"/></p>
<p class="noindent">If we had a lot of content, it might even be a bit overwhelming to the user. Instead, we might like to make it so that we show and hide when the user clicks on each heading so they can focus on the content in that particular section. In other words, we would use JavaScript to create a simple accordion widget.</p>
<p class="indent">To make our simple accordion, first we mark it as an accordion by putting some attribute—either a <span class="codesample"><strong>class</strong></span> name, an <span class="codesample"><strong>id</strong></span>, or even a <span class="codesample"><strong>data-*</strong></span> attribute—on the element(s) we want to enhance:</p>
<p class="imagea"><img alt="image" src="f0617-02.jpg"/></p>
<p class="noindent">Marking it in some manner makes it both easier to script and style.</p>
<p class="indent"><a id="page_618"/>Next, we make the heading links since we are going to bind some interactivity to them:</p>
<p class="imagea"><img alt="image" src="f0618-01.jpg"/></p>
<p class="noindent">Obviously, we don’t have to do this because we could put click events on them with JavaScript, but remember that, following progressive enhancement, we are trying to layer from simple to complex, and the general way we make something interactive in HTML is with a link.</p>
<p class="indent">Next, we would need to style the link and hide the content under it. This puts a little style in place and hides the content until it is revealed later on. We don’t really need JavaScript to do this, just a little CSS:</p>
<p class="imagea"><img alt="image" src="f0618-02.jpg"/></p>
<p class="noindent">At this point, our primitive accordion looks like some clickable headings with nothing under them:</p>
<p class="imagea"><img alt="image" src="f0618-03.jpg"/></p>
<p class="indent">Now, on page load we find all the links in the accordion and wire up a function to each. The idea is that when a heading is clicked, we will hide any content currently being shown. We’ll indicate this by setting a <span class="codesample"><strong>class</strong></span> called “<span class="codesample">shown</span>.” We’ll set the display property of this content to none and then remove the <span class="codesample"><strong>class</strong></span> name since it isn’t shown. Next, we will get the content near the clicked link and show it by setting its CSS <span class="codesample">display</span> property and then toggle the <span class="codesample"><strong>class</strong></span> to indicate that it is currently visible. We also toggle the state of the links by adding and removing a <span class="codesample"><strong>class</strong></span> called “<span class="codesample">open</span>.” This will then add and remove a symbol indicating the state of the content. The code to do this isn’t terribly long and is shown here:</p>
<p class="imagea"><img alt="image" src="f0618-04.jpg"/></p>
<p class="indent"><a id="page_619"/>The accordion then works roughly as shown in <a class="nounder" href="ch14.html#fig14-1">Figure 14-1</a>.</p>
<p class="imagea"><a id="fig14-1"/><img alt="image" src="f0619-01.jpg"/></p>
<p class="figcap"><strong>Figure 14-1</strong> Very simple progressive enhancement accordion in action</p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.javascriptref.com/3ed/ch14/accordionsimple.html">http://javascriptref.com/3ed/ch14/accordionsimple.html</a></p>
<p class="indent">Obviously, we made some significant simplifying assumptions here in terms of the structure of the markup in the accordion widget and the availability of useful DOM methods such as <span class="codesample">nextElementSibling</span>. Further, we might want to allow an ability to return to an all-closed state or maybe for multiple elements to be open. Finally, we might like to improve the look of the example. Rather than re-creating existing code, we remind readers that we are showing the approach of layering on top of markup.</p>
<p class="indent"><a id="page_620"/>There are plenty of existing JavaScript libraries that take this approach and address all the various cases we might be interested in. In the following example, shown in <a class="nounder" href="ch14.html#fig14-2">Figure 14-2</a>, we use a simple jQuery accordion widget to get a much richer look:</p>
<p class="imagea"><a id="fig14-2"/><img alt="image" src="f0621-01.jpg"/></p>
<p class="figcap"><strong>Figure 14-2</strong> jQuery’s accordion widget utilizes progressive enhancement.</p>
<p class="imagea"><img alt="image" src="f0620-01.jpg"/></p>
<p class="imagea"><img alt="image" src="f0620-02.jpg"/></p>
<p class="imagea"><img alt="image" src="f0620-03.jpg"/></p>
<hr/>
<p class="online"><a id="page_621"/><strong>ONLINE</strong> <a class="nounder" href="http://www.javascriptref.com/3ed/ch14/accordionjquery.html">http://javascriptref.com/3ed/ch14/accordionjquery.html</a></p>
<p class="indent">At this point, you should understand the idea of taking markup and style and using JavaScript to enhance the user’s experience. Before exploring some aspects of HTML5 that lend themselves to building interface elements, let’s explain an alternative approach that is more dependent on the availability of JavaScript.</p>
<h5 class="h5"><a id="ch14lev2sec2"/><strong>Graceful Degradation Approaches</strong></h5>
<p class="noindent">A quite different approach would be to use JavaScript for everything, building an entire application out of code. In this case, the HTML is pretty much just a framework and may have no body content at all or just empty <span class="codesample"><strong>&lt;div&gt;</strong></span> elements representing the sections of the application. Taking this approach, our accordion example might look like this:</p>
<p class="imagea"><img alt="image" src="f0621-02.jpg"/></p>
<p class="indent">Be careful when marveling at the beauty of separation here. The style sheets are still there, just linked—and while we see no markup, we must generate the HTML and content <a id="page_622"/>dynamically to make the accordion widget. Since that content must live somewhere, we might hold the configuration of the widget in a simple JavaScript or a JSON structure:</p>
<p class="imagea"><img alt="image" src="f0622-01.jpg"/></p>
<p class="indent">Given our configuration, we would then go and create the accordion dynamically:</p>
<p class="imagea"><img alt="image" src="f0622-02.jpg"/></p>
<p class="noindenttop">The page that follows would be the same, as we have created the same kind of markup as before.</p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/accordiongraceful.html">http://www.javascriptref.com/3ed/ch14/accordiongraceful.html</a></p>
<p class="indent">While there is purity to this all-JavaScript approach, looks can be a bit deceiving. First, we need to let the user know what happened in the case that JavaScript is not available. This could be handled fairly simply with the <span class="codesample"><strong>&lt;noscript&gt;</strong></span> tag, like so:</p>
<p class="imagea"><a id="page_623"/><img alt="image" src="f0623-01.jpg"/></p>
<p class="noindent">Of course, this means we require JavaScript for functionality. That might be a legitimate requirement for an internal or very advanced application, though likely a bit troubling for a public-facing, content-driven Web site. Your choice of approach should be driven by this thought.</p>
<p class="indent">Unfortunately, many developers seem to get attached to one way or the other being better. Usually there is some emphasis on the purity of separation between markup, style, and script. The reality is that neither approach wins here. Consider, in this case, that we have buried some markup into both our configuration structure as well as the code. You might, then, exclaim that if we would use templates we would avoid this problem of intermixture. The truth is you can never completely separate things. We can have implied logic in the structure of our markup, implied or explicit logic in a template, special naming conventions that imply meaning, or we can bury markup in our code, and on and on. Fundamentally, all the technologies touch; they have to, as there simply is no way not to, except in the most contrived cases. We present this point because we don’t want readers to think that we declare a winner here with our upcoming examples, which generally employ progressive enhancement. Understand that we do this because we want to illustrate the new interface ideas that are dominantly based upon HTML5 tags. By showing these tags, we hope readers will become more familiar with them, but the approach to use them can be either progressive enhancement or graceful degradation.</p>
<h4 class="h4"><a id="ch14lev1sec2"/><strong>HTML5 Support for Rich Interaction</strong></h4>
<p class="noindent">A primary motivation of the HTML5 effort has been to support the development of Web applications. The HTML markup language itself has even been modified to support new elements that will make the creation of applications far easier. These new tags, attributes, and associated APIs can be employed to make application-style interaction or to act as hooks for JavaScript to bind to add such interaction. We have seen a number of these already in <a class="nounder" href="ch13.html#ch13">Chapter 13</a> when exploring the new form elements introduced by HTML5. In this section, we survey other user interface–focused features of HTML5 that are beyond standard form fields.</p>
<h5 class="h5"><a id="ch14lev2sec3"/><strong>Menus and Context Menus</strong></h5>
<p class="noindent">One of the most interesting HTML5 elements for interface creation is the revived <span class="codesample"><strong>menu</strong></span> element. Traditionally, this element was supposed to be used to create a simple menu for choices, and most browsers simply rendered it as an unordered list:</p>
<p class="imagea"><img alt="image" src="f0623-02.jpg"/></p>
<p class="indent"><a id="page_624"/>Under HTML5, the <span class="codesample"><strong>menu</strong></span> element has been returned to its original purpose. A new attribute, <span class="codesample"><strong>type</strong></span>, is introduced that takes a value of <span class="codesample"><strong>toolbar, context</strong></span>, or <span class="codesample"><strong>list</strong></span> (the default). This example sets up a simple File menu for a Web application:</p>
<p class="imagea"><img alt="image" src="f0624-01.jpg"/></p>
<p class="indent">Using CSS and JavaScript, this menu might render like so:</p>
<p class="imagea"><img alt="image" src="f0624-02.jpg"/></p>
<p class="noindent">Again, this is completely speculative and is just meant to illustrate a possibility.</p>
<p class="indent">The <span class="codesample"><strong>menu</strong></span> element may contain not just links, but other interactive items, including the newly introduced <span class="codesample"><strong>command</strong></span> element. This empty element takes a <span class="codesample"><strong>label</strong></span> and may have an icon decoration as well. The <span class="codesample"><strong>command</strong></span> element has a <span class="codesample"><strong>type</strong></span> attribute, which may be set to <span class="codesample"><strong>command, radio</strong></span>, or <span class="codesample"><strong>checkbox</strong></span>, though when <span class="codesample"><strong>radio</strong></span> is employed there needs to be a <span class="codesample"><strong>radiogroup</strong></span> indication. A simple example here with the repurposed <span class="codesample"><strong>menu</strong></span> element should illustrate the possible use of this element:</p>
<p class="imagea"><img alt="image" src="f0624-03.jpg"/></p>
<p class="noindent"><a id="page_625"/>Such a menu might look like the following:</p>
<p class="imagea"><img alt="image" src="f0625-01.jpg"/></p>
<p class="noindent">HTML5 makes it simple to add context menu items to the built-in browser context menu. Control is quite granular; in fact, it is even possible to add different menu items based on where the context menu is activated.</p>
<p class="indent">To demonstrate, let’s make a simple menu example using HTML5’s modified <span class="codesample"><strong>&lt;menu&gt;</strong></span> tag. First, we make sure that our main <span class="codesample"><strong>&lt;menu&gt;</strong></span> tag has an <span class="codesample"><strong>id</strong></span> attribute and a type set to <span class="codesample"><strong>“context”</strong></span>:</p>
<p class="imagea"><img alt="image" src="f0625-02.jpg"/></p>
<p class="noindent">Within this tag, we include various <span class="codesample"><strong>&lt;command&gt;</strong></span> tags for individual items and then consider using submenus enclosed in <span class="codesample"><strong>&lt;menu&gt;</strong></span> tags themselves:</p>
<p class="imagea"><img alt="image" src="f0625-03.jpg"/></p>
<p class="noindenttop">Once we define our menu with markup, we then choose the element where the context menu items should appear and place the <span class="codesample"><strong>contextmenu</strong></span> attribute on that element. It is possible to put the <span class="codesample"><strong>contextmenu</strong></span> attribute on the <span class="codesample"><strong>&lt;body&gt;</strong></span> tag if the context menu should appear anywhere on the page. The attribute should be set to the <span class="codesample"><strong>id</strong></span> of the menu:</p>
<p class="imagea"><a id="page_626"/><img alt="image" src="f0625-04.jpg"/></p>
<p class="indent">Each <span class="codesample"><strong>&lt;command&gt;</strong></span> also should be hooked up to events with normal JavaScript <span class="codesample">onclick</span> event handlers:</p>
<p class="imagea"><img alt="image" src="f0626-01.jpg"/></p>
<p class="imagea"><img alt="image" src="f0626-02.jpg"/></p>
<p class="noindent">Now our newly defined commands would appear in the browser’s context menu when it is activated over this section of the Web page. It might look something like this if your browser supports the syntax:</p>
<p class="imagea"><img alt="image" src="f0626-03.jpg"/></p>
<hr/>
<p class="online"><a id="page_627"/><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/contextmenu.html">http://www.javascriptref.com/3ed/ch14/contextmenu.html</a></p>
<p class="indent">At the time of this book’s release, no browsers support this exact syntax. However, Firefox has implemented a very similar structure that uses <span class="codesample"><strong>&lt;menuitem&gt;</strong></span> tags instead of <span class="codesample"><strong>&lt;command&gt;</strong></span> tags for the menu items. The <span class="codesample"><strong>&lt;menuitem&gt;</strong></span> tag is not in the HTML5 specification currently, but there are current discussions about adding it.</p>
<p class="imagea"><img alt="image" src="f0627-01.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/contextmenu-ff.html">http://www.javascriptref.com/3ed/ch14/contextmenu-ff.html</a></p>
<p class="indent">Obviously, there is no preexisting way to add items to the browser’s context menu if it does not support these new tags. However, we can get a similar effect if we hide the browser’s context menu and make our own menu using standard tags and CSS. We illustrate that idea now because it is quite likely that will be the method you’ll employ—or your library will— given browser support.</p>
<p class="indent">To make our own context menus, we need to first hide the browser’s context menu. To do this, simply capture the <span class="codesample">oncontextmenu</span> event on either the document itself or on a particular element and return <span class="codesample">false</span>, like so:</p>
<p class="imagea"><img alt="image" src="f0627-02.jpg"/></p>
<p class="indent">Next, we want to display our own context menu. There are many ways to achieve this goal using standard tags and CSS with some JavaScript to glue it together. First, we build the structure in the HTML. In this case, we will use <span class="codesample"><strong>&lt;ul&gt;</strong></span> and <span class="codesample"><strong>&lt;li&gt;</strong></span> tags to indicate the menus and items. These tags are convenient since they allow a logical way to add submenus. The class names are important since we will be handling the styling ourselves:</p>
<p class="imagea"><img alt="image" src="f0627-03.jpg"/></p>
<p class="indent"><a id="page_628"/>The CSS shown here is used to style the menu:</p>
<p class="imagea"><img alt="image" src="f0628-01.jpg"/></p>
<p class="imagea"><img alt="image" src="f0628-02.jpg"/></p>
<p class="indent"><a id="page_629"/>There are two important things to note from the CSS. The first is that the main menu and the submenus are hidden by default. They will be made visible through the JavaScript at the appropriate time. The second important thing is that there is a special hover-related class. This class will be turned on whenever we move our pointer over a menu item; therefore, the style of the item will change.</p>
<p class="indent">Now that we have created the structure and style of our context menus, we need to hook them up using JavaScript. The first thing is to modify the <span class="codesample">oncontextmenu</span> event handler. Instead of simply returning <span class="codesample">false</span>, we also need to calculate and set the position of our context menu and then unhide the box:</p>
<p class="imagea"><img alt="image" src="f0629-01.jpg"/></p>
<p class="noindent">Next, we need to loop through all of the menu items and set event handlers for <span class="codesample">onmouseover</span> and <span class="codesample">onmouseout</span>. This will allow us to set and remove the <span class="codesample">hover</span> class as appropriate:</p>
<p class="imagea"><img alt="image" src="f0629-02.jpg"/></p>
<p class="noindent"><a id="page_630"/>With everything in place, when right-clicking over the appropriate area, we see our custom context menu instead of the browser’s built-in menu:</p>
<p class="imagea"><img alt="image" src="f0630-01.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/contextmenu-divs.html">http://www.javascriptref.com/3ed/ch14/contextmenu-divs.html</a></p>
<p class="indent">Now, with a little thought, we should be able to take the HTML5 syntax and patch it to use the JavaScript-based menus if the browser does not support the syntax. This approach would allow us to write our context menus using the HTML5 standard–based tags, but convert those tags into the list-based context menus in the previous example if they are not supported.</p>
<p class="indent">To create this patch for the context menu, we need to first check if the current functionality is supported. This is tricky since some browsers support the element but don’t implement it. In this case, the <span class="codesample">type</span> property is not implemented, so we check support for that as well:</p>
<p class="imagea"><img alt="image" src="f0630-02.jpg"/></p>
<p class="noindent">If this ability to detect for support and then use script intrigues you, take a look at <a class="nounder" href="ch16.html#ch16">Chapter 16</a>, which has much to say on the subject.</p>
<p class="indent">Now, if we determine that we need to show a generated menu, we employ our <span class="codesample"><em>translateMenu()</em></span> function, where we convert all of the <span class="codesample"><strong>&lt;menu&gt;</strong></span> tags into <span class="codesample"><strong>&lt;ul&gt;</strong></span> tags and the <span class="codesample"><strong>&lt;command&gt;</strong></span> tags into <span class="codesample"><strong>&lt;li&gt;</strong></span> tags. This is done in a recursive manner so that we can ensure that submenus are added properly and with the appropriate class name. Finally, we remove the unsupported markup and replace it with the generated markup. We need to make sure, though, that when we translate the elements we keep the <span class="codesample"><strong>id</strong></span> attributes intact. This allows our event hookups to work with the new elements:</p>
<p class="imagea"><img alt="image" src="f0630-03.jpg"/></p>
<p class="imagea"><img alt="image" src="f0630-04.jpg"/></p>
<hr/>
<p class="online"><a id="page_631"/><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/contextmenu-bc.html">http://www.javascriptref.com/3ed/ch14/contextmenu-bc.html</a></p>
<p class="indent">Hopefully, assuming the shifting sands of browser technology don’t undo our hard work, our custom context menu will be displayed regardless of a browser’s support for the HTML5 syntax. Of course, as we have previously mentioned, in this chapter our approach is meant to be illustrative, rather than perfect production quality, and will illuminate what is going on in the user interface package you pick or allow you to write your own.</p>
<h5 class="h5"><a id="ch14lev2sec4"/><strong>Drag-and-Drop Functionality</strong></h5>
<p class="noindent">In the past, drag-and-drop capability was a difficult endeavor to handle in JavaScript applications. Many people went to external libraries to help implement this functionality. It was certainly possible to have it in a Web page, but it did require a lot of code, even though it might be hidden in a library.</p>
<p class="indent">The times have changed, and one of HTML5’s welcome additions is this new drag-and-drop functionality. Many events specific to it have now been included in the specification and implemented by the major browsers. In addition, a couple of attributes have been added to further simplify the process. Finally, the browser manages the dragging itself, so it is no longer necessary to modify CSS positions to mimic dragging.</p>
<p class="indent">HTML5 adds a few new attributes that apply to drag-and-drop coding. The first is <span class="codesample"><strong>draggable</strong></span> and can be placed on any element that can be dragged. When <span class="codesample"><strong>draggable</strong></span> is set to <span class="codesample">true</span> on an element, the user will be able to drag it around the page, though it will not be moved on drop until we hook it up to the drag-and-drop events seen shortly. In most <a id="page_632"/>supporting browsers, simply setting <span class="codesample"><strong>draggable=“true”</strong></span> will be enough to drag a shadow of the object around the page, but in Firefox it is currently necessary to set the data that will be dragged via the <span class="codesample">DataTransfer</span> object. We will look at this object and details later in this section. In addition to setting the <span class="codesample"><strong>draggable</strong></span> attribute, it is helpful to the user to set the <span class="codesample">cursor</span> on the object to <span class="codesample">move</span> so that there is an indication that the object can be dragged:</p>
<p class="imagea"><img alt="image" src="f0632-01.jpg"/></p>
<p class="imagea"><img alt="image" src="f0632-02.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/drag.html">http://www.javascriptref.com/3ed/ch14/drag.html</a></p>
<hr/>
<p class="note"><strong>NOTE</strong> HTML5 also defines a <span class="codesample"><strong>dropzone</strong></span> attribute. We do not discuss it significantly since, so far, it is not supported and because there seems to be some concern about its future.</p>
<p class="indent">When looking at this example, it is fun to see that the object can be dragged all over the page but that when the mouse is released, the draggable copy disappears and only the original remains in the normal place. In order to make the drag-and-drop code functional, event handlers must be added in. There are several available handlers, and they are listed in <a class="nounder" href="ch14.html#tab14-1">Table 14-1.</a></p>
<p class="tabcap"><a id="tab14-1"/><strong>Table 14-1</strong> HTML5 Drag Event Summary</p>
<p class="imagea"><img alt="image" src="t0633-01.jpg"/></p>
<p class="indent">As we can see, some of the events apply to the item being dragged and some apply to the elements that are being dragged over. It is not necessary for the item to be dragged over to be a drop zone. It may be desirable to style an element as not a drop zone if the user carried the dragged item to the region. The <span class="codesample">ondrag</span> and <span class="codesample">ondragover</span> event handlers fire continuously as the drag is occurring. It is not typically necessary to have events that fire so rapidly, so use these with caution. With the other events available, most functionality can be handled without these handlers. However, at the time of this book’s release, it is necessary to capture the <span class="codesample">ondragover</span> event and prevent the default action in order for the drop event to fire.</p>
<p class="imagea"><img alt="image" src="f0632-03.jpg"/></p>
<p class="indent"><a id="page_633"/>In this example, we hook up the drag-and-drop events and modify the style based on the dragging action. When the object is dropped, we check to see if it is in a valid region and then display an alert message for the user:</p>
<p class="imagea"><img alt="image" src="f0633-01.jpg"/></p>
<p class="imagea"><img alt="image" src="f0633-02.jpg"/></p>
<p class="imagea"><img alt="image" src="f0633-03.jpg"/></p>
<hr/>
<p class="online"><a id="page_634"/><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/dragdrop.html">http://www.javascriptref.com/3ed/ch14/dragdrop.html</a></p>
<p class="indent">Although this example is improved from the previous one in its interactive feedback, it still doesn’t allow us to move an item from one location to another. The <span class="codesample">DataTransfer</span> object is necessary to complete our drag-and-drop operation. In addition, Firefox requires <span class="codesample">DataTransfer</span> to begin the dragging process. It is possible to access the <span class="codesample">DataTransfer</span> object through <span class="codesample">e.dataTransfer</span> within all of the drag-and-drop events previously discussed. The draggable object sets the <span class="codesample">dataTransfer.effectAllowed</span> property. This property is most commonly set in the <span class="codesample">ondragstart</span> event and can be set to “<span class="codesample">none</span>”, “<span class="codesample">copy</span>”, “<span class="codesample">copyLink</span>”, “<span class="codesample">copyMove</span>”, “<span class="codesample">link</span>”, “<span class="codesample">linkMove</span>”, “<span class="codesample">move</span>”, “<span class="codesample">all</span>”, and “<span class="codesample">uninitialized</span>”. On the other side, <span class="codesample">dataTransfer.dropEffect</span> can be set in the possible drop zones. This can be set to <span class="codesample">“move”</span>, <span class="codesample">“copy</span>”, “<span class="codesample">link</span>”, or “<span class="codesample">none</span>”. This indicates what should happen to the object being dragged when it is dropped in this zone. These attributes provide visual clues to users to what will happen when they drag-and-drop something. They do not restrict any action.</p>
<p class="indent">The <span class="codesample">dataTransfer.getData(<em>format</em></span>) and <span class="codesample">dataTransfer.setData(<em>format, data</em>)</span> can be used to move data during a drag-and-drop operation. The <span class="codesample"><em>format</em></span> should be set to the mime type of the data. With this addition, we see that the drag-and-drop capability now works in Firefox.</p>
<p class="imagea"><a id="page_635"/><img alt="image" src="f0635-01.jpg"/></p>
<p class="indent">Here we see a brief example of the transfer:</p>
<p class="imagea"><img alt="image" src="f0635-02.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/dragdropeffect.html">http://www.javascriptref.com/3ed/ch14/dragdropeffect.html</a></p>
<p class="indent">Using these ideas, it is trivial to implement a draggable list:</p>
<p class="imagea"><img alt="image" src="f0635-03.jpg"/></p>
<p class="imagea"><img alt="image" src="f0635-04.jpg"/></p>
<p class="imagea"><img alt="image" src="f0635-05.jpg"/></p>
<p class="imagea"><a id="page_636"/><img alt="image" src="f0636-01.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/draglist.html">http://www.javascriptref.com/3ed/ch14/draglist.html</a></p>
<p class="indent">Now we put those properties to use with files. A file can be dragged from your computer onto a Web page. If the element that is dropped is set up to handle it, the page can read the file without going to the server. The <span class="codesample">DataTransfer</span> object has a <span class="codesample">files</span> property that holds a <span class="codesample">FileList</span> containing files dropped in the region. The following example, displayed in <a class="nounder" href="ch14.html#fig14-3">Figure 14-3</a>, shows the basics of how drag-and-drop uploading might be accomplished:</p>
<p class="imagea"><a id="fig14-3"/><img alt="image" src="f0638-01.jpg"/></p>
<p class="figcap"><strong>Figure 14-3</strong> Drag-and-drop file uploads</p>
<p class="imagea"><a id="page_637"/><img alt="image" src="f0637-01.jpg"/></p>
<p class="imagea"><img alt="image" src="f0637-02.jpg"/></p>
<p class="imagea"><img alt="image" src="f0637-03.jpg"/></p>
<p class="imagea"><img alt="image" src="f0637-04.jpg"/></p>
<hr/>
<p class="online"><a id="page_638"/><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/file.html">http://www.javascriptref.com/3ed/ch14/file.html</a></p>
<p class="indent"><a id="page_639"/>There is more to HTML5’s drag-and-drop functionality; unfortunately, given the volatility of what we haven’t covered well—namely changes to the data transfer interface and native <span class="codesample"><strong>dropzone</strong></span> support—we are going to have to use the “permanency of ink on paper” excuse again and direct readers to consult the latest information that can be found online.</p>
<h5 class="h5"><a id="ch14lev2sec5"/><strong>Content Editing</strong></h5>
<p class="noindent">Readers should be highly familiar with the “click-to-edit interface” idiom from desktop operating systems that allow file renaming in such a manner. In this click-to-edit scenario, the user selects the object of interest and typically clicks or double-clicks the object to invoke editing. The presentation changes to show that the user is in edit mode, often by modifying the cursor to an insert indicator such as an I-beam. Presentation changes may also include stroking or highlighting the range of the content to be edited:</p>
<p class="imagea"><img alt="image" src="f0639-01.jpg"/></p>
<p class="noindent">After the editing occurs, the changes are committed simply by blurring the edit region, usually by clicking some other place in the interface.</p>
<p class="indent">In simple applications, the changes are immediately saved, though it is possible not to commit the changes immediately but instead “dirty” the content. In such a situation, changed content typically will be indicated with a different style such as italics, and a Save button will be activated elsewhere to perform the actual change commit.</p>
<p class="indent">The basic idea for implementing such a facility would require first indicating what would be editable, both visually and programmatically. Programmatically, this might include defining a class name:</p>
<p class="imagea"><img alt="image" src="f0639-02.jpg"/></p>
<p class="noindenttop">You could also use a <span class="codesample"><strong>data-*</strong></span> attribute:</p>
<p class="imagea"><img alt="image" src="f0639-03.jpg"/></p>
<p class="noindenttop">Then you would use JavaScript to find the elements in question and bind an <span class="codesample"><em>edit()</em></span> function that would take the contents and replace them with a form field to edit them and, on blur, return them back:</p>
<p class="imagea"><img alt="image" src="f0639-04.jpg"/></p>
<p class="imagea"><img alt="image" src="f0639-05.jpg"/></p>
<p class="imagea"><img alt="image" src="f0639-06.jpg"/></p>
<hr/>
<p class="online"><a id="page_640"/><strong>ONLINE</strong> <a class="nounder" href="http://www.javascriptref.com/3ed/ch14/clicktoedit.html">http://javascriptref.com/3ed/ch14/clicktoedit.html</a></p>
<p class="imagea"><img alt="image" src="f0640-01.jpg"/></p>
<p class="noindenttop"><a id="page_641"/>While this is easy enough to accomplish in raw JavaScript, HTML5 has codified the initially proprietary <span class="codesample"><strong>contenteditable</strong></span> attribute from Internet Explorer as standard. Simply setting this attribute directly</p>
<p class="imagea"><img alt="image" src="f0641-01.jpg"/></p>
<p class="noindenttop">or via code makes the content directly editable:</p>
<p class="imagea"><img alt="image" src="f0641-02.jpg"/></p>
<p class="indenttop">While setting an element as editable is useful, if we use the newer HTML5 approach we actually can richly edit the content when we are in the editing mode. For example, if we enter editing mode and then select some content with our pointer, we can issue the following method call:</p>
<p class="imagea"><img alt="image" src="f0641-03.jpg"/></p>
<p class="noindenttop">We can change the highlighted content in a WYSIWYG manner to the italic style. If we view the HTML, we see that it just put an <span class="codesample"><strong>&lt;i&gt;</strong></span> tag around the effected content. The <span class="codesample">execCommand()</span> method allows us to perform a number of WYSIWYG editor actions such as changing color, style, background, and more. It also allows us to perform common editor commands such as undo, redo, and cut. The following example, also shown in <a class="nounder" href="ch14.html#fig14-4">Figure 14-4</a>, should give you a flavor of the features available:</p>
<p class="imagea"><a id="fig14-4"/><img alt="image" src="f0643-01.jpg"/></p>
<p class="figcap"><strong>Figure 14-4</strong> Built-in rich text editing example</p>
<p class="imagea"><img alt="image" src="f0641-04.jpg"/></p>
<p class="imagea"><img alt="image" src="f0641-05.jpg"/></p>
<p class="imagea"><img alt="image" src="f0641-06.jpg"/></p>
<p class="imagea"><img alt="image" src="f0641-07.jpg"/></p>
<p class="imagea"><img alt="image" src="f0641-08.jpg"/><a id="page_642"/></p>
<hr/>
<p class="online"><a id="page_643"/><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/contentEditable.html">http://www.javascriptref.com/3ed/ch14/contentEditable.html</a></p>
<p class="indent">This particular API is quite involved, and we mean here to introduce it so that readers are aware of the possibilities, but we warn that at the time of this edition’s writing it was not well formalized or finished.</p>
<h5 class="h5"><a id="ch14lev2sec6"/><a id="page_644"/><strong>Revealing Content on Demand</strong></h5>
<p class="noindenttop">HTML5 provides a number of features to reveal content on demand. Using standard JavaScript we might reveal content that is buried in markup simply by changing the CSS <span class="codesample">visibility</span> property or the <span class="codesample">display</span> property, like so:</p>
<p class="imagea"><img alt="image" src="f0644-01.jpg"/></p>
<p class="indenttop">HTML5 has gone a step further and introduced a simple attribute <span class="codesample"><strong>hidden</strong></span> whose presence indicates that an object should not be displayed. If we change the corresponding property to <span class="codesample">true</span> or <span class="codesample">false</span>, we can hide or show the object, as shown here:</p>
<p class="imagea"><img alt="image" src="f0644-02.jpg"/></p>
<p class="indenttop">If we are looking to relate the showing and hiding of content, HTML5 provides the <span class="codesample"><strong>&lt;details&gt;</strong></span> tag, first introduced in <a class="nounder" href="ch13.html#ch13">Chapter 13</a>, which will distill enclosed content to whatever is found in its <span class="codesample"><strong>&lt;summary&gt;</strong></span> tag:</p>
<p class="imagea"><img alt="image" src="f0644-03.jpg"/></p>
<p class="imagea"><img alt="image" src="f0644-04.jpg"/></p>
<p class="indent">The <span class="codesample">details</span> element has one useful property <span class="codesample">(open)</span> that contains a Boolean value that indicates whether the summary content is shown or not. We can both get and set this property to control the state of the element:</p>
<p class="imagea"><img alt="image" src="f0644-05.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/details.html">http://www.javascriptref.com/3ed/ch14/details.html</a></p>
<h5 class="h5"><a id="page_645"/><a id="ch14lev2sec7"/><strong>User Feedback</strong></h5>
<p class="noindent">As we wind down this chapter, we expose two more elements that may be useful in our next topic. <a class="nounder" href="ch15.html#ch15">Chapter 15</a> discusses Ajax, which allows us to communicate with the server using JavaScript. However, once we start making network calls, we will find that letting users know what is going on becomes more important. Fortunately, letting users know about status is becoming much easier, as two fairly similar elements have been introduced in HTML5 to show the current status of something. First up, the <span class="codesample"><strong>meter</strong></span> element defines a scalar measurement within a known range, similar to what might be represented by a gauge. The following example is a reading of velocity for some fantastically fast space vessel:</p>
<p class="imagea"><img alt="image" src="f0645-01.jpg"/></p>
<p class="noindent">The value can be updated simply through JavaScript:</p>
<p class="imagea"><img alt="image" src="f0645-02.jpg"/></p>
<p class="imagea"><img alt="image" src="f0645-03.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/meter.html">http://www.javascriptref.com/3ed/ch14/meter.html</a></p>
<p class="indent">Slightly different from <span class="codesample"><strong>meter</strong></span> is the <span class="codesample"><strong>progress</strong></span> element, which defines the completion progress for some task. Commonly, this element might represent 0 to 100 percent of a task to be completed, such as loading:</p>
<p class="imagea"><img alt="image" src="f0645-04.jpg"/></p>
<p class="noindenttop">Again, this element can be easily updated through JavaScript:</p>
<p class="imagea"><img alt="image" src="f0645-05.jpg"/></p>
<p class="imagea"><img alt="image" src="f0645-06.jpg"/></p>
<hr/>
<p class="online"><strong>ONLINE</strong> <a class="nounder" href="http://www.www.javascriptref.com/3ed/ch14/progress.html">http://www.javascriptref.com/3ed/ch14/progress.html</a></p>
<p class="indent"><a id="page_646"/>There are certainly more interface widgets that we did not cover, but those would be ones that we would have to create dynamically with JavaScript. Our aim here was to show the interface features and APIs that HTML5 and other APIs are bringing to the browser. If our observation is correct, over time, more and more interface constructs will be brought natively to the browser, which will both eliminate the need for certain aspects of JavaScript libraries and continue to blur the line between desktop application interface design and Web application interface design.</p>
<h4 class="h4"><a id="ch14lev1sec3"/><strong>Summary</strong></h4>
<p class="noindent">The difference between Web applications and regular applications is quickly disappearing. The interface conventions and permissions of the desktop are now becoming available via JavaScript. As this edition goes to print, we see APIs that allow for camera control, file system access, device orientation, full-screen display of content and even more being proposed weekly. This chapter first attempted to present how we might add such interface ideas to an application, either by enhancing markup or creating it via code. We believe strongly that the declarative markup approach will not be deprecated any time soon, particularly as HTML5 introduces numerous APIs that allow complex interactions such as context-sensitive commands, drag-and-drop capability, rich editing, content on demand, and more. Obviously, the interface is not enough to make a rich Web application, so in <a class="nounder" href="ch15.html#ch15">Chapter 15</a> we discuss the use of JavaScript communication technology—generally dubbed Ajax—to interact with server-side programs.</p>
</body>
</html>